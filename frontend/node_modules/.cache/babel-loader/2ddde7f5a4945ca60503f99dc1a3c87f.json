{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/nikitajethani/Desktop/cs 4530/covey.town-master/frontend/src/App.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useCallback, useEffect, useMemo, useReducer, useState } from 'react';\nimport './App.css';\nimport { BrowserRouter } from 'react-router-dom';\nimport { io } from 'socket.io-client';\nimport { ChakraProvider } from '@chakra-ui/react';\nimport { MuiThemeProvider } from '@material-ui/core/styles';\nimport assert from 'assert';\nimport WorldMap from './components/world/WorldMap';\nimport VideoOverlay from './components/VideoCall/VideoOverlay/VideoOverlay';\nimport VideoContext from './contexts/VideoContext';\nimport Login from './components/Login/Login';\nimport CoveyAppContext from './contexts/CoveyAppContext';\nimport NearbyPlayersContext from './contexts/NearbyPlayersContext';\nimport AppStateProvider, { useAppState } from './components/VideoCall/VideoFrontend/state';\nimport useConnectionOptions from './components/VideoCall/VideoFrontend/utils/useConnectionOptions/useConnectionOptions';\nimport UnsupportedBrowserWarning from './components/VideoCall/VideoFrontend/components/UnsupportedBrowserWarning/UnsupportedBrowserWarning';\nimport { VideoProvider } from './components/VideoCall/VideoFrontend/components/VideoProvider';\nimport ErrorDialog from './components/VideoCall/VideoFrontend/components/ErrorDialog/ErrorDialog';\nimport theme from './components/VideoCall/VideoFrontend/theme';\nimport Player from './classes/Player';\nimport TownsServiceClient from './classes/TownsServiceClient';\nimport Video from './classes/Video/Video';\n\nfunction defaultAppState() {\n  return {\n    nearbyPlayers: {\n      nearbyPlayers: []\n    },\n    players: [],\n    myPlayerID: '',\n    currentTownFriendlyName: '',\n    currentTownID: '',\n    currentTownIsPubliclyListed: false,\n    sessionToken: '',\n    userName: '',\n    socket: null,\n    currentLocation: {\n      x: 0,\n      y: 0,\n      rotation: 'front',\n      moving: false\n    },\n    emitMovement: () => {},\n    apiClient: new TownsServiceClient()\n  };\n}\n\nfunction appStateReducer(state, update) {\n  var _state$socket;\n\n  const nextState = {\n    sessionToken: state.sessionToken,\n    currentTownFriendlyName: state.currentTownFriendlyName,\n    currentTownID: state.currentTownID,\n    currentTownIsPubliclyListed: state.currentTownIsPubliclyListed,\n    myPlayerID: state.myPlayerID,\n    players: state.players,\n    currentLocation: state.currentLocation,\n    nearbyPlayers: state.nearbyPlayers,\n    userName: state.userName,\n    socket: state.socket,\n    emitMovement: state.emitMovement,\n    apiClient: state.apiClient\n  };\n\n  function calculateNearbyPlayers(players, currentLocation) {\n    const isWithinCallRadius = (p, location) => {\n      if (p.location && location) {\n        const dx = p.location.x - location.x;\n        const dy = p.location.y - location.y;\n        const d = Math.sqrt(dx * dx + dy * dy);\n        return d < 80;\n      }\n\n      return false;\n    };\n\n    return {\n      nearbyPlayers: players.filter(p => isWithinCallRadius(p, currentLocation))\n    };\n  }\n\n  function samePlayers(a1, a2) {\n    if (a1.nearbyPlayers.length !== a2.nearbyPlayers.length) return false;\n    const ids1 = a1.nearbyPlayers.map(p => p.id).sort();\n    const ids2 = a2.nearbyPlayers.map(p => p.id).sort();\n    return !ids1.some((val, idx) => val !== ids2[idx]);\n  }\n\n  let updatePlayer;\n\n  switch (update.action) {\n    case 'doConnect':\n      nextState.sessionToken = update.data.sessionToken;\n      nextState.myPlayerID = update.data.myPlayerID;\n      nextState.currentTownFriendlyName = update.data.townFriendlyName;\n      nextState.currentTownID = update.data.townID;\n      nextState.currentTownIsPubliclyListed = update.data.townIsPubliclyListed;\n      nextState.userName = update.data.userName;\n      nextState.emitMovement = update.data.emitMovement;\n      nextState.socket = update.data.socket;\n      nextState.players = update.data.players;\n      break;\n\n    case 'addPlayer':\n      nextState.players = nextState.players.concat([update.player]);\n      break;\n\n    case 'playerMoved':\n      updatePlayer = nextState.players.find(p => p.id === update.player.id);\n\n      if (updatePlayer) {\n        updatePlayer.location = update.player.location;\n      } else {\n        nextState.players = nextState.players.concat([update.player]);\n      }\n\n      nextState.nearbyPlayers = calculateNearbyPlayers(nextState.players, nextState.currentLocation);\n\n      if (samePlayers(nextState.nearbyPlayers, state.nearbyPlayers)) {\n        nextState.nearbyPlayers = state.nearbyPlayers;\n      }\n\n      break;\n\n    case 'weMoved':\n      nextState.currentLocation = update.location;\n      nextState.nearbyPlayers = calculateNearbyPlayers(nextState.players, nextState.currentLocation);\n\n      if (samePlayers(nextState.nearbyPlayers, state.nearbyPlayers)) {\n        nextState.nearbyPlayers = state.nearbyPlayers;\n      }\n\n      break;\n\n    case 'playerDisconnect':\n      nextState.players = nextState.players.filter(player => player.id !== update.player.id);\n      nextState.nearbyPlayers = calculateNearbyPlayers(nextState.players, nextState.currentLocation);\n\n      if (samePlayers(nextState.nearbyPlayers, state.nearbyPlayers)) {\n        nextState.nearbyPlayers = state.nearbyPlayers;\n      }\n\n      break;\n\n    case 'disconnect':\n      (_state$socket = state.socket) === null || _state$socket === void 0 ? void 0 : _state$socket.disconnect();\n      return defaultAppState();\n\n    default:\n      throw new Error('Unexpected state request');\n  }\n\n  return nextState;\n}\n\nasync function GameController(initData, dispatchAppUpdate) {\n  // Now, set up the game sockets\n  const gamePlayerID = initData.coveyUserID;\n  const sessionToken = initData.coveySessionToken;\n  const url = process.env.REACT_APP_TOWNS_SERVICE_URL;\n  assert(url);\n  const video = Video.instance();\n  assert(video);\n  const roomName = video.townFriendlyName;\n  assert(roomName);\n  const socket = io(url, {\n    auth: {\n      token: sessionToken,\n      coveyTownID: video.coveyTownID\n    }\n  });\n  socket.on('newPlayer', player => {\n    dispatchAppUpdate({\n      action: 'addPlayer',\n      player: Player.fromServerPlayer(player)\n    });\n  });\n  socket.on('playerMoved', player => {\n    if (player._id !== gamePlayerID) {\n      dispatchAppUpdate({\n        action: 'playerMoved',\n        player: Player.fromServerPlayer(player)\n      });\n    }\n  });\n  socket.on('playerDisconnect', player => {\n    dispatchAppUpdate({\n      action: 'playerDisconnect',\n      player: Player.fromServerPlayer(player)\n    });\n  });\n  socket.on('disconnect', () => {\n    dispatchAppUpdate({\n      action: 'disconnect'\n    });\n  });\n\n  const emitMovement = location => {\n    socket.emit('playerMovement', location);\n    dispatchAppUpdate({\n      action: 'weMoved',\n      location\n    });\n  };\n\n  dispatchAppUpdate({\n    action: 'doConnect',\n    data: {\n      sessionToken,\n      userName: video.userName,\n      townFriendlyName: roomName,\n      townID: video.coveyTownID,\n      myPlayerID: gamePlayerID,\n      townIsPubliclyListed: video.isPubliclyListed,\n      emitMovement,\n      socket,\n      players: initData.currentPlayers.map(sp => Player.fromServerPlayer(sp))\n    }\n  });\n  return true;\n}\n\n_c = GameController;\n\nfunction App(props) {\n  _s();\n\n  const [appState, dispatchAppUpdate] = useReducer(appStateReducer, defaultAppState());\n  const setupGameController = useCallback(async initData => {\n    await GameController(initData, dispatchAppUpdate);\n    return true;\n  }, [dispatchAppUpdate]);\n  const videoInstance = Video.instance();\n  const {\n    setOnDisconnect\n  } = props;\n  useEffect(() => {\n    setOnDisconnect(() => async () => {\n      // Here's a great gotcha: https://medium.com/swlh/how-to-store-a-function-with-the-usestate-hook-in-react-8a88dd4eede1\n      dispatchAppUpdate({\n        action: 'disconnect'\n      });\n      return Video.teardown();\n    });\n  }, [dispatchAppUpdate, setOnDisconnect]);\n  const page = useMemo(() => {\n    if (!appState.sessionToken) {\n      return /*#__PURE__*/_jsxDEV(Login, {\n        doLogin: setupGameController\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 14\n      }, this);\n    }\n\n    if (!videoInstance) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"Loading...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 14\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(WorldMap, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(VideoOverlay, {\n        preferredMode: \"fullwidth\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 7\n    }, this);\n  }, [setupGameController, appState.sessionToken, videoInstance]);\n  return /*#__PURE__*/_jsxDEV(CoveyAppContext.Provider, {\n    value: appState,\n    children: /*#__PURE__*/_jsxDEV(VideoContext.Provider, {\n      value: Video.instance(),\n      children: /*#__PURE__*/_jsxDEV(NearbyPlayersContext.Provider, {\n        value: appState.nearbyPlayers,\n        children: page\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 234,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"hlZHenlJOnd4q2CYPlKmw/zwGNA=\");\n\n_c2 = App;\n\nfunction EmbeddedTwilioAppWrapper() {\n  _s2();\n\n  const {\n    error,\n    setError\n  } = useAppState();\n  const [onDisconnect, setOnDisconnect] = useState();\n  const connectionOptions = useConnectionOptions();\n  return /*#__PURE__*/_jsxDEV(UnsupportedBrowserWarning, {\n    children: /*#__PURE__*/_jsxDEV(VideoProvider, {\n      options: connectionOptions,\n      onError: setError,\n      onDisconnect: onDisconnect,\n      children: [/*#__PURE__*/_jsxDEV(ErrorDialog, {\n        dismissError: () => setError(null),\n        error: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(App, {\n        setOnDisconnect: setOnDisconnect\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 250,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(EmbeddedTwilioAppWrapper, \"L1gaqrf8YLZNV/J5WP4vEWpalos=\", false, function () {\n  return [useAppState, useConnectionOptions];\n});\n\n_c3 = EmbeddedTwilioAppWrapper;\nexport default function AppStateWrapper() {\n  return /*#__PURE__*/_jsxDEV(BrowserRouter, {\n    children: /*#__PURE__*/_jsxDEV(ChakraProvider, {\n      children: /*#__PURE__*/_jsxDEV(MuiThemeProvider, {\n        theme: theme('rgb(185, 37, 0)'),\n        children: /*#__PURE__*/_jsxDEV(AppStateProvider, {\n          preferredMode: \"fullwidth\",\n          highlightedProfiles: [],\n          children: /*#__PURE__*/_jsxDEV(EmbeddedTwilioAppWrapper, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 261,\n    columnNumber: 5\n  }, this);\n}\n_c4 = AppStateWrapper;\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"GameController\");\n$RefreshReg$(_c2, \"App\");\n$RefreshReg$(_c3, \"EmbeddedTwilioAppWrapper\");\n$RefreshReg$(_c4, \"AppStateWrapper\");","map":{"version":3,"sources":["/Users/nikitajethani/Desktop/cs 4530/covey.town-master/frontend/src/App.tsx"],"names":["React","useCallback","useEffect","useMemo","useReducer","useState","BrowserRouter","io","ChakraProvider","MuiThemeProvider","assert","WorldMap","VideoOverlay","VideoContext","Login","CoveyAppContext","NearbyPlayersContext","AppStateProvider","useAppState","useConnectionOptions","UnsupportedBrowserWarning","VideoProvider","ErrorDialog","theme","Player","TownsServiceClient","Video","defaultAppState","nearbyPlayers","players","myPlayerID","currentTownFriendlyName","currentTownID","currentTownIsPubliclyListed","sessionToken","userName","socket","currentLocation","x","y","rotation","moving","emitMovement","apiClient","appStateReducer","state","update","nextState","calculateNearbyPlayers","isWithinCallRadius","p","location","dx","dy","d","Math","sqrt","filter","samePlayers","a1","a2","length","ids1","map","id","sort","ids2","some","val","idx","updatePlayer","action","data","townFriendlyName","townID","townIsPubliclyListed","concat","player","find","disconnect","Error","GameController","initData","dispatchAppUpdate","gamePlayerID","coveyUserID","coveySessionToken","url","process","env","REACT_APP_TOWNS_SERVICE_URL","video","instance","roomName","auth","token","coveyTownID","on","fromServerPlayer","_id","emit","isPubliclyListed","currentPlayers","sp","App","props","appState","setupGameController","videoInstance","setOnDisconnect","teardown","page","EmbeddedTwilioAppWrapper","error","setError","onDisconnect","connectionOptions","AppStateWrapper"],"mappings":"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","sourcesContent":["import React, {\n  Dispatch, SetStateAction, useCallback, useEffect, useMemo, useReducer, useState,\n} from 'react';\nimport './App.css';\nimport { BrowserRouter } from 'react-router-dom';\nimport { io, Socket } from 'socket.io-client';\nimport { ChakraProvider } from '@chakra-ui/react';\nimport { MuiThemeProvider } from '@material-ui/core/styles';\nimport assert from 'assert';\nimport WorldMap from './components/world/WorldMap';\nimport VideoOverlay from './components/VideoCall/VideoOverlay/VideoOverlay';\nimport { CoveyAppState, NearbyPlayers } from './CoveyTypes';\nimport VideoContext from './contexts/VideoContext';\nimport Login from './components/Login/Login';\nimport CoveyAppContext from './contexts/CoveyAppContext';\nimport NearbyPlayersContext from './contexts/NearbyPlayersContext';\nimport AppStateProvider, { useAppState } from './components/VideoCall/VideoFrontend/state';\nimport useConnectionOptions from './components/VideoCall/VideoFrontend/utils/useConnectionOptions/useConnectionOptions';\nimport UnsupportedBrowserWarning\n  from './components/VideoCall/VideoFrontend/components/UnsupportedBrowserWarning/UnsupportedBrowserWarning';\nimport { VideoProvider } from './components/VideoCall/VideoFrontend/components/VideoProvider';\nimport ErrorDialog from './components/VideoCall/VideoFrontend/components/ErrorDialog/ErrorDialog';\nimport theme from './components/VideoCall/VideoFrontend/theme';\nimport { Callback } from './components/VideoCall/VideoFrontend/types';\nimport Player, { ServerPlayer, UserLocation } from './classes/Player';\nimport TownsServiceClient, { TownJoinResponse } from './classes/TownsServiceClient';\nimport Video from './classes/Video/Video';\n\ntype CoveyAppUpdate =\n  | { action: 'doConnect'; data: { userName: string, townFriendlyName: string, townID: string,townIsPubliclyListed:boolean, sessionToken: string, myPlayerID: string, socket: Socket, players: Player[], emitMovement: (location: UserLocation) => void } }\n  | { action: 'addPlayer'; player: Player }\n  | { action: 'playerMoved'; player: Player }\n  | { action: 'playerDisconnect'; player: Player }\n  | { action: 'weMoved'; location: UserLocation }\n  | { action: 'disconnect' }\n  ;\n\nfunction defaultAppState(): CoveyAppState {\n  return {\n    nearbyPlayers: { nearbyPlayers: [] },\n    players: [],\n    myPlayerID: '',\n    currentTownFriendlyName: '',\n    currentTownID: '',\n    currentTownIsPubliclyListed: false,\n    sessionToken: '',\n    userName: '',\n    socket: null,\n    currentLocation: {\n      x: 0, y: 0, rotation: 'front', moving: false,\n    },\n    emitMovement: () => {\n    },\n    apiClient: new TownsServiceClient(),\n  };\n}\nfunction appStateReducer(state: CoveyAppState, update: CoveyAppUpdate): CoveyAppState {\n  const nextState = {\n    sessionToken: state.sessionToken,\n    currentTownFriendlyName: state.currentTownFriendlyName,\n    currentTownID: state.currentTownID,\n    currentTownIsPubliclyListed: state.currentTownIsPubliclyListed,\n    myPlayerID: state.myPlayerID,\n    players: state.players,\n    currentLocation: state.currentLocation,\n    nearbyPlayers: state.nearbyPlayers,\n    userName: state.userName,\n    socket: state.socket,\n    emitMovement: state.emitMovement,\n    apiClient: state.apiClient,\n  };\n\n  function calculateNearbyPlayers(players: Player[], currentLocation: UserLocation) {\n    const isWithinCallRadius = (p: Player, location: UserLocation) => {\n      if (p.location && location) {\n        const dx = p.location.x - location.x;\n        const dy = p.location.y - location.y;\n        const d = Math.sqrt(dx * dx + dy * dy);\n        return d < 80;\n      }\n      return false;\n    };\n    return { nearbyPlayers: players.filter((p) => isWithinCallRadius(p, currentLocation)) };\n  }\n\n  function samePlayers(a1: NearbyPlayers, a2: NearbyPlayers) {\n    if (a1.nearbyPlayers.length !== a2.nearbyPlayers.length) return false;\n    const ids1 = a1.nearbyPlayers.map((p) => p.id).sort();\n    const ids2 = a2.nearbyPlayers.map((p) => p.id).sort();\n    return !ids1.some((val, idx) => val !== ids2[idx]);\n  }\n\n  let updatePlayer;\n  switch (update.action) {\n    case 'doConnect':\n      nextState.sessionToken = update.data.sessionToken;\n      nextState.myPlayerID = update.data.myPlayerID;\n      nextState.currentTownFriendlyName = update.data.townFriendlyName;\n      nextState.currentTownID = update.data.townID;\n      nextState.currentTownIsPubliclyListed = update.data.townIsPubliclyListed;\n      nextState.userName = update.data.userName;\n      nextState.emitMovement = update.data.emitMovement;\n      nextState.socket = update.data.socket;\n      nextState.players = update.data.players;\n      break;\n    case 'addPlayer':\n      nextState.players = nextState.players.concat([update.player]);\n      break;\n    case 'playerMoved':\n      updatePlayer = nextState.players.find((p) => p.id === update.player.id);\n      if (updatePlayer) {\n        updatePlayer.location = update.player.location;\n      } else {\n        nextState.players = nextState.players.concat([update.player]);\n      }\n      nextState.nearbyPlayers = calculateNearbyPlayers(nextState.players,\n        nextState.currentLocation);\n      if (samePlayers(nextState.nearbyPlayers, state.nearbyPlayers)) {\n        nextState.nearbyPlayers = state.nearbyPlayers;\n      }\n      break;\n    case 'weMoved':\n      nextState.currentLocation = update.location;\n      nextState.nearbyPlayers = calculateNearbyPlayers(nextState.players,\n        nextState.currentLocation);\n      if (samePlayers(nextState.nearbyPlayers, state.nearbyPlayers)) {\n        nextState.nearbyPlayers = state.nearbyPlayers;\n      }\n\n      break;\n    case 'playerDisconnect':\n      nextState.players = nextState.players.filter((player) => player.id !== update.player.id);\n\n      nextState.nearbyPlayers = calculateNearbyPlayers(nextState.players,\n        nextState.currentLocation);\n      if (samePlayers(nextState.nearbyPlayers, state.nearbyPlayers)) {\n        nextState.nearbyPlayers = state.nearbyPlayers;\n      }\n      break;\n    case 'disconnect':\n      state.socket?.disconnect();\n      return defaultAppState();\n    default:\n      throw new Error('Unexpected state request');\n  }\n\n  return nextState;\n}\n\nasync function GameController(initData: TownJoinResponse,\n  dispatchAppUpdate: (update: CoveyAppUpdate) => void) {\n  // Now, set up the game sockets\n  const gamePlayerID = initData.coveyUserID;\n  const sessionToken = initData.coveySessionToken;\n  const url = process.env.REACT_APP_TOWNS_SERVICE_URL;\n  assert(url);\n  const video = Video.instance();\n  assert(video);\n  const roomName = video.townFriendlyName;\n  assert(roomName);\n\n  const socket = io(url, { auth: { token: sessionToken, coveyTownID: video.coveyTownID } });\n  socket.on('newPlayer', (player: ServerPlayer) => {\n    dispatchAppUpdate({\n      action: 'addPlayer',\n      player: Player.fromServerPlayer(player),\n    });\n  });\n  socket.on('playerMoved', (player: ServerPlayer) => {\n    if (player._id !== gamePlayerID) {\n      dispatchAppUpdate({ action: 'playerMoved', player: Player.fromServerPlayer(player) });\n    }\n  });\n  socket.on('playerDisconnect', (player: ServerPlayer) => {\n    dispatchAppUpdate({ action: 'playerDisconnect', player: Player.fromServerPlayer(player) });\n  });\n  socket.on('disconnect', () => {\n    dispatchAppUpdate({ action: 'disconnect' });\n  });\n  const emitMovement = (location: UserLocation) => {\n    socket.emit('playerMovement', location);\n    dispatchAppUpdate({ action: 'weMoved', location });\n  };\n\n  dispatchAppUpdate({\n    action: 'doConnect',\n    data: {\n      sessionToken,\n      userName: video.userName,\n      townFriendlyName: roomName,\n      townID: video.coveyTownID,\n      myPlayerID: gamePlayerID,\n      townIsPubliclyListed: video.isPubliclyListed,\n      emitMovement,\n      socket,\n      players: initData.currentPlayers.map((sp) => Player.fromServerPlayer(sp)),\n    },\n  });\n  return true;\n}\n\nfunction App(props: { setOnDisconnect: Dispatch<SetStateAction<Callback | undefined>> }) {\n  const [appState, dispatchAppUpdate] = useReducer(appStateReducer, defaultAppState());\n\n  const setupGameController = useCallback(async (initData: TownJoinResponse) => {\n    await GameController(initData, dispatchAppUpdate);\n    return true;\n  }, [dispatchAppUpdate]);\n  const videoInstance = Video.instance();\n\n  const { setOnDisconnect } = props;\n  useEffect(() => {\n    setOnDisconnect(() => async () => { // Here's a great gotcha: https://medium.com/swlh/how-to-store-a-function-with-the-usestate-hook-in-react-8a88dd4eede1\n      dispatchAppUpdate({ action: 'disconnect' });\n      return Video.teardown();\n    });\n  }, [dispatchAppUpdate, setOnDisconnect]);\n\n  const page = useMemo(() => {\n    if (!appState.sessionToken) {\n      return <Login doLogin={setupGameController} />;\n    } if (!videoInstance) {\n      return <div>Loading...</div>;\n    }\n    return (\n      <div>\n        <WorldMap />\n        <VideoOverlay preferredMode=\"fullwidth\" />\n      </div>\n    );\n  }, [setupGameController, appState.sessionToken, videoInstance]);\n  return (\n\n    <CoveyAppContext.Provider value={appState}>\n      <VideoContext.Provider value={Video.instance()}>\n        <NearbyPlayersContext.Provider value={appState.nearbyPlayers}>\n          {page}\n        </NearbyPlayersContext.Provider>\n      </VideoContext.Provider>\n    </CoveyAppContext.Provider>\n\n  );\n}\n\nfunction EmbeddedTwilioAppWrapper() {\n  const { error, setError } = useAppState();\n  const [onDisconnect, setOnDisconnect] = useState<Callback | undefined>();\n  const connectionOptions = useConnectionOptions();\n  return (\n    <UnsupportedBrowserWarning>\n      <VideoProvider options={connectionOptions} onError={setError} onDisconnect={onDisconnect}>\n        <ErrorDialog dismissError={() => setError(null)} error={error} />\n        <App setOnDisconnect={setOnDisconnect} />\n      </VideoProvider>\n    </UnsupportedBrowserWarning>\n  );\n}\n\nexport default function AppStateWrapper(): JSX.Element {\n  return (\n    <BrowserRouter>\n      <ChakraProvider>\n        <MuiThemeProvider theme={theme('rgb(185, 37, 0)')}>\n          <AppStateProvider preferredMode=\"fullwidth\" highlightedProfiles={[]}>\n            <EmbeddedTwilioAppWrapper />\n          </AppStateProvider>\n        </MuiThemeProvider>\n      </ChakraProvider>\n    </BrowserRouter>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}