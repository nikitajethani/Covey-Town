{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/nikitajethani/Desktop/cs 4530/covey.town-master/frontend/src/components/VideoCall/VideoFrontend/components/AudioLevelIndicator/AudioLevelIndicator.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport { interval } from 'd3-timer';\nimport useIsTrackEnabled from '../../hooks/useIsTrackEnabled/useIsTrackEnabled';\nimport useMediaStreamTrack from '../../hooks/useMediaStreamTrack/useMediaStreamTrack';\nlet clipId = 0;\n\nconst getUniqueClipId = () => clipId++; // @ts-ignore\n\n\nconst AudioContext = window.AudioContext || window.webkitAudioContext;\nlet audioContext;\nexport function initializeAnalyser(stream) {\n  audioContext = audioContext || new AudioContext();\n  const audioSource = audioContext.createMediaStreamSource(stream);\n  const analyser = audioContext.createAnalyser();\n  analyser.smoothingTimeConstant = 0.2;\n  analyser.fftSize = 256;\n  audioSource.connect(analyser);\n  return analyser;\n}\n\nfunction AudioLevelIndicator({\n  audioTrack,\n  color = 'white'\n}) {\n  _s();\n\n  const SVGRectRef = useRef(null);\n  const [analyser, setAnalyser] = useState();\n  const isTrackEnabled = useIsTrackEnabled(audioTrack);\n  const mediaStreamTrack = useMediaStreamTrack(audioTrack);\n  useEffect(() => {\n    if (audioTrack && mediaStreamTrack && isTrackEnabled) {\n      // Here we create a new MediaStream from a clone of the mediaStreamTrack.\n      // A clone is created to allow multiple instances of this component for a single\n      // AudioTrack on iOS Safari.\n      let newMediaStream = new MediaStream([mediaStreamTrack.clone()]); // Here we listen for the 'stopped' event on the audioTrack. When the audioTrack is stopped,\n      // we stop the cloned track that is stored in 'newMediaStream'. It is important that we stop\n      // all tracks when they are not in use. Browsers like Firefox don't let you create a new stream\n      // from a new audio device while the active audio device still has active tracks.\n\n      const stopAllMediaStreamTracks = () => newMediaStream.getTracks().forEach(track => track.stop());\n\n      audioTrack.on('stopped', stopAllMediaStreamTracks);\n\n      const reinitializeAnalyser = () => {\n        stopAllMediaStreamTracks();\n        newMediaStream = new MediaStream([mediaStreamTrack.clone()]);\n        setAnalyser(initializeAnalyser(newMediaStream));\n      };\n\n      setAnalyser(initializeAnalyser(newMediaStream)); // Here we reinitialize the AnalyserNode on focus to avoid an issue in Safari\n      // where the analysers stop functioning when the user switches to a new tab\n      // and switches back to the app.\n\n      window.addEventListener('focus', reinitializeAnalyser);\n      return () => {\n        stopAllMediaStreamTracks();\n        window.removeEventListener('focus', reinitializeAnalyser);\n        audioTrack.off('stopped', stopAllMediaStreamTracks);\n      };\n    }\n\n    return () => {};\n  }, [isTrackEnabled, mediaStreamTrack, audioTrack]);\n  useEffect(() => {\n    const SVGClipElement = SVGRectRef.current;\n\n    if (isTrackEnabled && SVGClipElement && analyser) {\n      const sampleArray = new Uint8Array(analyser.frequencyBinCount);\n      const timer = interval(() => {\n        analyser.getByteFrequencyData(sampleArray);\n        let values = 0;\n        const {\n          length\n        } = sampleArray;\n\n        for (let i = 0; i < length; i++) {\n          values += sampleArray[i];\n        }\n\n        const volume = Math.min(14, Math.max(0, Math.log10(values / length / 3) * 7));\n        SVGClipElement === null || SVGClipElement === void 0 ? void 0 : SVGClipElement.setAttribute('y', String(14 - volume));\n      }, 100);\n      return () => {\n        SVGClipElement.setAttribute('y', '14');\n        timer.stop();\n      };\n    }\n\n    return () => {};\n  }, [isTrackEnabled, analyser]); // Each instance of this component will need a unique HTML ID\n\n  const clipPathId = `audio-level-clip-${getUniqueClipId()}`;\n  return isTrackEnabled ? /*#__PURE__*/_jsxDEV(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: \"24\",\n    height: \"24\",\n    viewBox: \"0 0 24 24\",\n    \"data-test-audio-indicator\": true,\n    children: [/*#__PURE__*/_jsxDEV(\"defs\", {\n      children: /*#__PURE__*/_jsxDEV(\"clipPath\", {\n        id: clipPathId,\n        children: /*#__PURE__*/_jsxDEV(\"rect\", {\n          ref: SVGRectRef,\n          x: \"0\",\n          y: \"14\",\n          width: \"24\",\n          height: \"24\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"g\", {\n      fill: \"none\",\n      fillRule: \"evenodd\",\n      transform: \"translate(.5)\",\n      children: [/*#__PURE__*/_jsxDEV(\"rect\", {\n        clipPath: `url(#${clipPathId})`,\n        width: \"5.2\",\n        height: \"10\",\n        x: \"9.5\",\n        y: \"3.5\",\n        rx: \"6\",\n        ry: \"3\",\n        fill: \"#23BF6E\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n        fill: color,\n        strokeWidth: \"0\",\n        d: \"M17.389 10.667c.276 0 .5.224.5.5 0 3.114-2.396 5.67-5.445 5.923v2.632c0 .276-.223.5-.5.5-.245 0-.45-.177-.491-.41l-.009-.09V17.09C8.395 16.836 6 14.281 6 11.167c0-.276.224-.5.5-.5s.5.224.5.5c0 2.73 2.214 4.944 4.944 4.944 2.731 0 4.945-2.214 4.945-4.944 0-.276.224-.5.5-.5zM11.944 4c1.566 0 2.834 1.268 2.834 2.833v4.334c0 1.564-1.268 2.833-2.834 2.833-1.564 0-2.833-1.27-2.833-2.833V6.833C9.111 5.268 10.38 4 11.944 4zm0 1c-1.012 0-1.833.82-1.833 1.833v4.334c0 1.012.822 1.833 1.833 1.833 1.013 0 1.834-.82 1.834-1.833V6.833c0-1.013-.82-1.833-1.834-1.833z\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 5\n  }, this) : /*#__PURE__*/_jsxDEV(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: \"24\",\n    height: \"24\",\n    viewBox: \"0 0 24 24\",\n    transform: \"translate(-0.5, 0)\",\n    \"data-test-audio-mute-icon\": true,\n    children: /*#__PURE__*/_jsxDEV(\"g\", {\n      fill: \"none\",\n      fillRule: \"evenodd\",\n      children: [/*#__PURE__*/_jsxDEV(\"path\", {\n        fill: color,\n        strokeWidth: \"0\",\n        d: \"M11.889 6.667c.276 0 .5.224.5.5 0 3.114-2.396 5.67-5.445 5.923v2.632c0 .276-.223.5-.5.5-.245 0-.45-.177-.491-.41l-.009-.09V13.09c-1.116-.093-2.145-.494-3-1.119l.717-.717c.793.54 1.751.857 2.783.857 2.731 0 4.945-2.214 4.945-4.944 0-.276.224-.5.5-.5zM1 6.667c.276 0 .5.224.5.5 0 .975.282 1.884.77 2.65l-.722.721C.888 9.58.5 8.418.5 7.167c0-.276.224-.5.5-.5zm8.277-1.031v1.53C9.278 8.732 8.01 10 6.445 10c-.446 0-.868-.103-1.243-.287l.776-.773c.149.039.306.06.467.06.963 0 1.751-.74 1.828-1.683l.006-.15v-.531l1-1zM6.444 0C8.01 0 9.278 1.268 9.278 2.833l-.002-.025-.999.999v-.974c0-.962-.74-1.75-1.682-1.827L6.445 1c-.962 0-1.751.74-1.828 1.683l-.006.15v4.334c0 .097.008.192.022.285l-.804.805c-.112-.269-.184-.558-.209-.86l-.009-.23V2.833C3.611 1.268 4.88 0 6.444 0z\",\n        transform: \"translate(6.5 4)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n        fill: \"red\",\n        strokeWidth: \"0\",\n        d: \"M12.146.646c.196-.195.512-.195.708 0 .173.174.192.443.057.638l-.057.07-12 12c-.196.195-.512.195-.708 0-.173-.174-.192-.443-.057-.638l.057-.07 12-12z\",\n        transform: \"translate(6.5 4)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 127,\n    columnNumber: 5\n  }, this);\n}\n\n_s(AudioLevelIndicator, \"kEZKnP9y5WgmkA8c/Nh6ehPoZSU=\", false, function () {\n  return [useIsTrackEnabled, useMediaStreamTrack];\n});\n\n_c = AudioLevelIndicator;\nexport default _c2 = /*#__PURE__*/React.memo(AudioLevelIndicator);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"AudioLevelIndicator\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/nikitajethani/Desktop/cs 4530/covey.town-master/frontend/src/components/VideoCall/VideoFrontend/components/AudioLevelIndicator/AudioLevelIndicator.tsx"],"names":["React","useEffect","useRef","useState","interval","useIsTrackEnabled","useMediaStreamTrack","clipId","getUniqueClipId","AudioContext","window","webkitAudioContext","audioContext","initializeAnalyser","stream","audioSource","createMediaStreamSource","analyser","createAnalyser","smoothingTimeConstant","fftSize","connect","AudioLevelIndicator","audioTrack","color","SVGRectRef","setAnalyser","isTrackEnabled","mediaStreamTrack","newMediaStream","MediaStream","clone","stopAllMediaStreamTracks","getTracks","forEach","track","stop","on","reinitializeAnalyser","addEventListener","removeEventListener","off","SVGClipElement","current","sampleArray","Uint8Array","frequencyBinCount","timer","getByteFrequencyData","values","length","i","volume","Math","min","max","log10","setAttribute","String","clipPathId","memo"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { AudioTrack, LocalAudioTrack, RemoteAudioTrack } from 'twilio-video';\nimport { interval } from 'd3-timer';\nimport useIsTrackEnabled from '../../hooks/useIsTrackEnabled/useIsTrackEnabled';\nimport useMediaStreamTrack from '../../hooks/useMediaStreamTrack/useMediaStreamTrack';\n\nlet clipId = 0;\nconst getUniqueClipId = () => clipId++;\n\n// @ts-ignore\nconst AudioContext = window.AudioContext || window.webkitAudioContext;\nlet audioContext: AudioContext;\n\nexport function initializeAnalyser(stream: MediaStream) {\n  audioContext = audioContext || new AudioContext();\n  const audioSource = audioContext.createMediaStreamSource(stream);\n\n  const analyser = audioContext.createAnalyser();\n  analyser.smoothingTimeConstant = 0.2;\n  analyser.fftSize = 256;\n\n  audioSource.connect(analyser);\n  return analyser;\n}\n\nfunction AudioLevelIndicator({ audioTrack, color = 'white' }: { audioTrack?: AudioTrack; color?: string }) {\n  const SVGRectRef = useRef<SVGRectElement>(null);\n  const [analyser, setAnalyser] = useState<AnalyserNode>();\n  const isTrackEnabled = useIsTrackEnabled(audioTrack as LocalAudioTrack | RemoteAudioTrack);\n  const mediaStreamTrack = useMediaStreamTrack(audioTrack);\n\n  useEffect(() => {\n    if (audioTrack && mediaStreamTrack && isTrackEnabled) {\n      // Here we create a new MediaStream from a clone of the mediaStreamTrack.\n      // A clone is created to allow multiple instances of this component for a single\n      // AudioTrack on iOS Safari.\n      let newMediaStream = new MediaStream([mediaStreamTrack.clone()]);\n\n      // Here we listen for the 'stopped' event on the audioTrack. When the audioTrack is stopped,\n      // we stop the cloned track that is stored in 'newMediaStream'. It is important that we stop\n      // all tracks when they are not in use. Browsers like Firefox don't let you create a new stream\n      // from a new audio device while the active audio device still has active tracks.\n      const stopAllMediaStreamTracks = () => newMediaStream.getTracks().forEach((track) => track.stop());\n      audioTrack.on('stopped', stopAllMediaStreamTracks);\n\n      const reinitializeAnalyser = () => {\n        stopAllMediaStreamTracks();\n        newMediaStream = new MediaStream([mediaStreamTrack.clone()]);\n        setAnalyser(initializeAnalyser(newMediaStream));\n      };\n\n      setAnalyser(initializeAnalyser(newMediaStream));\n\n      // Here we reinitialize the AnalyserNode on focus to avoid an issue in Safari\n      // where the analysers stop functioning when the user switches to a new tab\n      // and switches back to the app.\n      window.addEventListener('focus', reinitializeAnalyser);\n\n      return () => {\n        stopAllMediaStreamTracks();\n        window.removeEventListener('focus', reinitializeAnalyser);\n        audioTrack.off('stopped', stopAllMediaStreamTracks);\n      };\n    }\n    return () => {\n    };\n  }, [isTrackEnabled, mediaStreamTrack, audioTrack]);\n\n  useEffect(() => {\n    const SVGClipElement = SVGRectRef.current;\n\n    if (isTrackEnabled && SVGClipElement && analyser) {\n      const sampleArray = new Uint8Array(analyser.frequencyBinCount);\n\n      const timer = interval(() => {\n        analyser.getByteFrequencyData(sampleArray);\n        let values = 0;\n\n        const { length } = sampleArray;\n        for (let i = 0; i < length; i++) {\n          values += sampleArray[i];\n        }\n\n        const volume = Math.min(14, Math.max(0, Math.log10(values / length / 3) * 7));\n\n        SVGClipElement?.setAttribute('y', String(14 - volume));\n      }, 100);\n\n      return () => {\n        SVGClipElement.setAttribute('y', '14');\n        timer.stop();\n      };\n    }\n    return () => {\n    };\n  }, [isTrackEnabled, analyser]);\n\n  // Each instance of this component will need a unique HTML ID\n  const clipPathId = `audio-level-clip-${getUniqueClipId()}`;\n\n  return isTrackEnabled ? (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" data-test-audio-indicator>\n      <defs>\n        <clipPath id={clipPathId}>\n          <rect ref={SVGRectRef} x=\"0\" y=\"14\" width=\"24\" height=\"24\" />\n        </clipPath>\n      </defs>\n      <g fill=\"none\" fillRule=\"evenodd\" transform=\"translate(.5)\">\n        <rect\n          clipPath={`url(#${clipPathId})`}\n          width=\"5.2\"\n          height=\"10\"\n          x=\"9.5\"\n          y=\"3.5\"\n          rx=\"6\"\n          ry=\"3\"\n          fill=\"#23BF6E\"\n        />\n        <path\n          fill={color}\n          strokeWidth=\"0\"\n          d=\"M17.389 10.667c.276 0 .5.224.5.5 0 3.114-2.396 5.67-5.445 5.923v2.632c0 .276-.223.5-.5.5-.245 0-.45-.177-.491-.41l-.009-.09V17.09C8.395 16.836 6 14.281 6 11.167c0-.276.224-.5.5-.5s.5.224.5.5c0 2.73 2.214 4.944 4.944 4.944 2.731 0 4.945-2.214 4.945-4.944 0-.276.224-.5.5-.5zM11.944 4c1.566 0 2.834 1.268 2.834 2.833v4.334c0 1.564-1.268 2.833-2.834 2.833-1.564 0-2.833-1.27-2.833-2.833V6.833C9.111 5.268 10.38 4 11.944 4zm0 1c-1.012 0-1.833.82-1.833 1.833v4.334c0 1.012.822 1.833 1.833 1.833 1.013 0 1.834-.82 1.834-1.833V6.833c0-1.013-.82-1.833-1.834-1.833z\"\n        />\n      </g>\n    </svg>\n  ) : (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      transform=\"translate(-0.5, 0)\"\n      data-test-audio-mute-icon\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path\n          fill={color}\n          strokeWidth=\"0\"\n          d=\"M11.889 6.667c.276 0 .5.224.5.5 0 3.114-2.396 5.67-5.445 5.923v2.632c0 .276-.223.5-.5.5-.245 0-.45-.177-.491-.41l-.009-.09V13.09c-1.116-.093-2.145-.494-3-1.119l.717-.717c.793.54 1.751.857 2.783.857 2.731 0 4.945-2.214 4.945-4.944 0-.276.224-.5.5-.5zM1 6.667c.276 0 .5.224.5.5 0 .975.282 1.884.77 2.65l-.722.721C.888 9.58.5 8.418.5 7.167c0-.276.224-.5.5-.5zm8.277-1.031v1.53C9.278 8.732 8.01 10 6.445 10c-.446 0-.868-.103-1.243-.287l.776-.773c.149.039.306.06.467.06.963 0 1.751-.74 1.828-1.683l.006-.15v-.531l1-1zM6.444 0C8.01 0 9.278 1.268 9.278 2.833l-.002-.025-.999.999v-.974c0-.962-.74-1.75-1.682-1.827L6.445 1c-.962 0-1.751.74-1.828 1.683l-.006.15v4.334c0 .097.008.192.022.285l-.804.805c-.112-.269-.184-.558-.209-.86l-.009-.23V2.833C3.611 1.268 4.88 0 6.444 0z\"\n          transform=\"translate(6.5 4)\"\n        />\n        <path\n          fill=\"red\"\n          strokeWidth=\"0\"\n          d=\"M12.146.646c.196-.195.512-.195.708 0 .173.174.192.443.057.638l-.057.07-12 12c-.196.195-.512.195-.708 0-.173-.174-.192-.443-.057-.638l.057-.07 12-12z\"\n          transform=\"translate(6.5 4)\"\n        />\n      </g>\n    </svg>\n  );\n}\n\nexport default React.memo(AudioLevelIndicator);\n"]},"metadata":{},"sourceType":"module"}